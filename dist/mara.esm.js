var t,e,n;(t=self.document)&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e));import o from"md5";import{nanoid as r}from"nanoid";import i from"file-saver";import a from"sweetalert2";import s from"axios";import c from"ali-oss";import u from"clipboard";import f from"toastify-js";function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function l(t,e,n,o,r,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,r)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function m(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),t}function y(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var w={qq:/\bm?qqbrowser\/([0-9.]+)/,360:function(t){return-1!==t.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/},aoyou:/\baoyou/,webview:/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/,firefox:/\bfirefox\/([0-9.ab]+)/,chrome:/ (?:chrome|crios|crmo)\/([0-9.]+)/,ie:/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,android:function(t){return-1===t.indexOf("android")?"":/\bversion\/([0-9.]+(?: beta)?)/},safari:/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//,opera:/\bopera/,unknow:"unknow"},g={windows:/\bwindows nt ([0-9.]+)/,macosx:/\bmac os x ([0-9._]+)/,linux:"linux",wphone:function(t){return-1!==t.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==t.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==t.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"},ios:function(t){return/\bcpu(?: iphone)? os /.test(t)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==t.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/},android:function(t){return t.indexOf("android")>=0?/\bandroid[ \/-]?([0-9.x]+)?/:t.indexOf("adr")>=0?t.indexOf("mqqbrowser")>=0?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"},unknow:"unknow"},b={weixin:/micromessenger/gi,qqvideo:/qqlivebrowser/gi,qqvideoipad:/qqlivehdbrowser/gi,shouqq:/qq\//gi,qqnews:/qqnews/gi,qzone:/qzone\//gi,unknow:"unknow"},x=function(t,e){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")},_=function(t,e){var n=j[t.toLowerCase()];for(var o in e){var r=e[o],i=x(r,"Function")?r(S()):r;if(n.name=o,!0===i)break;if("[object String]"===toString(i)){if(-1!==S().indexOf(i))break}else if(x(i,"Object")){if(void 0!==i.version){n.version=i.version;break}}else if(i&&i.exec){var a=i.exec(S());if(a){a.length>=2&&a[1]?n.version=a[1].replace(/_/g,"."):n.version="0.0.0";break}}}return n},S=function(){if(!n){var t="__",e=navigator.userAgent||"",o=navigator.platform||"",r=navigator.appVersion||"",i=navigator.vendor||"";n=(n=e+t+o+t+r+t+i).toLowerCase()}return n},k=function(t){n||(_("os",g),_("platform",b),_("browser",w));return"all"===t||"full"===t?S():void 0!==t?j[t].name:"".concat(j.os.name).concat("  ","_").concat(j.os.version,"  ").concat(j.browser.name).concat("  ","_").concat(j.browser.version)},j={os:{name:"unknow",version:"0.0.0"},platform:{name:"unknow",version:"0.0.0"},browser:{name:"unknow",version:"0.0.0"}},q=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var o=e[0],r=Array.prototype.slice.call(e,1),i=0;i<r.length;i++){var a=r[i];for(var s in a)o[s]=a[s]}return o},A=function(t){if(!t)return!0;if(!t.length)return!0;for(var e=0,n=t.length-1;n>0;n--)t[n]||(e+=1);return e>t.length-1},I=function(t){var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";t=t||9;for(var n="",o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*e.length));return n},L=function(t){for(var e=function(t){return t>=65&&t<91||t>=97&&t<123},n=t.toString().split(""),o="",r=0;r<13;){var i=n[r],a="".concat(i).concat(n[r+1]),s="".concat(a).concat(n[r+2]);e(parseInt(a))?(o+=String.fromCharCode(a),r+=2):e(parseInt(s))?(o+=String.fromCharCode(s),r+=3):(o+=i,r++)}return o.split("").reverse().join("")},T=function(t,e){return o("".concat(t).concat(e))},O=function(){function t(){if(h(this,t),t.instance)return t.instance;this.__pool__={},t.instance=this}return m(t,[{key:"setItem",value:function(t,e){this.__pool__[t]=e}},{key:"getItem",value:function(t){return this.__pool__[t]}},{key:"remove",value:function(t){this.__pool__[t]=null}}]),t}();O.instance=null;var C=new O,B=function(t){return 0===t.indexOf("csijs_")?t:"csijs_"+t},E=function(t,e,n){"object"===p(e)&&(e=n?e:function(t){try{return JSON.stringify(t)}catch(e){return t}}(e)),function(t,e){try{C.setItem(t,e),localStorage.setItem(t,e)}catch(t){console.error(t)}}(B(t),e)},P=function(t,e){var n=function(t){return C.getItem?C.getItem(t):null}(B(t));return n?e?n:function(t){try{return JSON.parse(t)}catch(e){return t}}(n):null},z=function(t){!function(t){try{C&&C.removeItem(t)}catch(t){}}(B(t))},R=function(){var t=P("info"),e=[],n=t?t.length:0;if(t&&n)for(var o=parseInt(t.max,10),r=parseInt(t.min,10);r<=o;r++){var i="".concat(t.type,"_").concat(r),a=P(i);e.push(a)}return e},K={download:"下载",copy:"复制",upload:"上传",report:"上报"},Q=null;function M(t,e){this.csiReport=t,this.env=e.env||"prod",this.appid=e.appid,this.appname=e.feID,this.operation=e.operationMethod||"download",K[this.operation]&&("copy"===this.operation&&console.warn("%cmara warning: operationMethod===copy功能即将废弃，请尽快切换成'upload'或'download'模式","font-size: 20px;"),this.mainBtnText=K[this.operation])}var N=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,n,o){var i,p,l,h,d,m,y,v,w,g,b,x,_,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=R().map((function(t){return"".concat(JSON.stringify(t,null,2),"\n")})),p=new Blob(i,{type:"text/plain;charset=utf-8"}),l="".concat(r(),".dat"),h=(new Date).getTime(),d=L(h),m=T(n,h),"prod"===e?(y="https://m7-hlgw-c1-openapi.longfor.com/julianos-prod/",g="a2e33eb4-6516-43f9-bcc0-9c47b0f123b3"):(y="//api-uat.longfor.com/julianos-uat/",g="791f6690-0714-445f-9273-78a3199622d2"),b={"X-Gaia-Api-Key":g},n?(v="api/mara/alioss/sts",b["x-mara-signature"]=m,b["x-mara-slug"]=d,b["x-mara-app-name"]=o):v="api/admin/alioss/sts",w="".concat(y).concat(v),t.next=12,s({method:"get",url:w,withCredentials:!0,headers:b});case 12:return x=t.sent.data.Credentials,_=new c({region:"oss-cn-beijing",accessKeyId:x.AccessKeyId,accessKeySecret:x.AccessKeySecret,stsToken:x.SecurityToken,bucket:"prod-zws-wuguofeng"}),t.next=16,_.put("mara/".concat(l),p);case 16:return t.next=18,_.signatureUrl("mara/".concat(l));case 18:S=t.sent,a.fire({title:"上传完成",icon:"success",showConfirmButton:!0,confirmButtonText:"复制链接",showCancelButton:!0,cancelButtonText:"关闭",preConfirm:function(){document.querySelector(".swal2-confirm").setAttribute("data-clipboard-text",S),Q&&Q.destroy(),(Q=new u(".swal2-confirm")).on("success",(function(t){console.log(t),f({text:"链接已复制",duration:1e3,gravity:"bottom",position:"center",style:{position:"fixed",margin:"0 auto",left:0,right:0,width:"80px",textAlign:"center",background:"black",zIndex:"999999",padding:"5px",opacity:.8,borderRadius:"5px",color:"white"}}).showToast(),t.clearSelection()}))}});case 20:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function a(t){l(i,o,r,a,s,"next",t)}function s(t){l(i,o,r,a,s,"throw",t)}a(void 0)}))});return function(t,n,o){return e.apply(this,arguments)}}();function D(t){this.csi=t,this.tapQueue=[]}M.prototype.createPage=function(){var t=this,e=R();A(e)?a.fire({title:"暂无异常",text:"稍后窗口会自动关闭",icon:"success",heightAuto:!1,timer:2e3}):a.fire({title:"收集完成",text:"收集到".concat(e.length,"条日志，点击下方按钮下载日志"),icon:"success",heightAuto:!1,showConfirmButton:!0,confirmButtonText:this.mainBtnText,showCancelButton:!0,cancelButtonText:"关闭",preConfirm:function(){return"upload"===t.operation?N(t.env,t.appid,t.appname):"copy"===t.operation?function(){var t=JSON.stringify(R(),null,2);document.querySelector(".swal2-confirm").setAttribute("data-clipboard-text",t),Q&&Q.destroy(),(Q=new u(".swal2-confirm")).on("success",(function(t){f({text:"复制成功",duration:1e3,gravity:"bottom",position:"center",style:{position:"fixed",margin:"0 auto",left:0,right:0,width:"80px",textAlign:"center",background:"black",zIndex:"999999",padding:"5px",opacity:.8,borderRadius:"5px",color:"white"}}).showToast(),t.clearSelection()}))}():function(){var t=R().map((function(t){return"".concat(JSON.stringify(t,null,2),"\n")})),e=new Blob(t,{type:"text/plain;charset=utf-8"}),n="".concat(r(),".dat");i.saveAs(e,n)}()}})},M.prototype.toggleShow=function(){a.isVisible()||this.createPage()},D.prototype={init:function(t){this.showPage=new M(this.csi.report.bind(this.csi),t),t.customPanelTrigger||this.bindDefaultTrigger()},onTapQueue:function(t,e){var n=this.tapQueue.length?this.tapQueue[this.tapQueue.length-1]:null;if(n&&t.timeStamp-n.timeStamp>300&&(this.tapQueue=[]),this.tapQueue.push(t),this.tapQueue.length===e)return this.tapQueue=[],!0}},D.prototype.bindDefaultTrigger=function(){var t=this;document.querySelector("html").addEventListener("touchend",(function(e){t.onTapQueue(e,4)&&setTimeout(t.toggleShow.bind(t),100)})),document.addEventListener("keydown",(function(e){(e=e||window.event).ctrlKey&&6===parseInt(e.key,10)&&t.showPage.toggleShow()}))},D.prototype.toggleShow=function(){this.showPage.toggleShow()};var J=function(t,e,n,o,r,i){return t.addLine({etype:"win error",msg:"".concat(e," \n ").concat(i&&i.stack),js:"".concat(n,":").concat(o,":").concat(r)}),!0},H=function(t){this.forms=t};H.prototype.probe=function(){var t=this,e=window.onerror;window.onerror=function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];"function"==typeof e&&e.apply(t,o),J(t.forms,o[0],o[1],o[2],o[3],o[4])}};var X={},F=function(t){this.forms=t},G=function(t,e,n){t.addLine({etype:"ajax error",msg:e,js:n.join(" :")})};F.prototype.probe=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0,o=this;this.logAjaxTrace=e,this.excludeKeywords=n||[];var i=XMLHttpRequest.prototype,a=i.open,s=i.send,c=i.setRequestHeader,u=function(e){for(var n=0;n<t.excludeKeywords.length;n++)if(-1!==e.indexOf(t.excludeKeywords[n]))return!0;return!1};XMLHttpRequest.prototype.open=function(){var t=Array.prototype.slice.call(arguments);if(t[1]&&u(t[1]))return a.apply(this,arguments);var e=r();this.__xhrid=e,o.addListener(this,arguments),a.apply(this,arguments)},XMLHttpRequest.prototype.setRequestHeader=function(){if(!this.__xhrid)return c.apply(this,arguments);var t=Array.prototype.slice.call(arguments),e=t[0],n=t[1];"content-type"===e.toLowerCase()&&n.toLowerCase().includes("application/json")&&(X[this.__xhrid].recordPayload=!0),c.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(!this.__xhrid)return s.apply(this,arguments);X[this.__xhrid].recordPayload&&(X[this.__xhrid].payload=Array.prototype.slice.call(arguments)),s.apply(this,arguments)}},F.prototype.addListener=function(t,e){var n=this;if(!X[t.__xhrid]){X[t.__xhrid]={xhr:t};var o=t.ontimeout;t.addEventListener("loadend",(function(){var o,r=t.status,i=X[t.__xhrid].payload||{};try{i=JSON.parse(i)}catch(t){i=i}try{o=JSON.parse(t.response)}catch(e){o=t.response}var a={status:r,payload:i,response:o};0!==parseInt(r)&&(/^2[0-9]{1,3}/gi.test(r)?n.logAjaxTrace&&function(t,e,n){t.addLine({etype:"ajax trace",msg:e,js:n.join(":")})}(n.forms,a,y(e)):G(n.forms,a,y(e)))})),t.addEventListener("error",(function(){G(n.forms,t.status||"networkError",y(e))})),t.ontimeout=function(){n.forms.addLine({etype:"ajax error",msg:"timeout ".concat(t.status),js:e.join(" :")});for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];o&&o.apply(n,i)}}};var U=function(t){this.forms=t};U.prototype.probe=function(){var t=this;if(window.fetch){var e=window.fetch;window.fetch=function(n,o){var r="GET",i=n||"";return"string"==typeof n?r=o&&o.method?o.method:r:"[object Request]"===Object.prototype.toString.call(n)&&(r=n.method||r,i=n.url||""),e(n,o).then((function(e){var n="".concat(e.status);return/^2[0-9]{1,3}/gi.test(n)||0==+n||t.forms.addLine({etype:"fetch error",msg:"status:".concat(e.status),js:"".concat(r," :").concat(i)}),e})).catch((function(e){var n;try{n=e&&e.message?e.message:JSON.stringify(e)}catch(t){n=e&&e.message?e.message:e}throw t.forms.addLine({etype:"fetch error",msg:n,js:"".concat(r," :").concat(i)}),e}))}}};var V=function(){this.fid="",this.uid="",this.min=0,this.max=0,this.type="",this.length=""},W=function(){this.pid="",this.index="",this.time="",this.ua="",this.etype="",this.msg="",this.url="",this.other=""},Y=function(t,e,n){var o={feid:t,uid:I(),min:0,max:0,type:e,length:0};this.maxLine=n||20,this.info=q(new V,o,P("info")),this.line=new W};Y.prototype={addLine:function(t){var e={pid:I(6),index:parseInt(this.info.max,10)+1,time:Date.now(),ua:k()};!function(t){for(var e in t)t[e]="";t.url=location?location.href:""}(this.line),q(this.line,e,t);var n="".concat(this.info.type,"_").concat(this.line.index);E(n,this.line),this.updateInfo(this.line)},updateInfo:function(t){var e=parseInt(t.index,10),n=parseInt(this.info.min,10),o=e-(n=n||e)+1;if(o>this.maxLine){for(var r=o-this.maxLine,i=0;i<r;i++){var a="".concat(this.info.type,"_").concat(n+i);z(a)}o=this.maxLine}this.info.length=o,this.info.min=e-o+1,this.info.max=e,E("info",this.info)}};var Z=function(t,e){this.errTable=new Y(t,"err",e)};Z.prototype={addLine:function(t){var e=this.errTable;setTimeout((function(){e.addLine(t)}),0)}};var $=function(){k();var t=j.browser,e=t.name,n=parseFloat(t.version);return"ie"===e&&n<9},tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,t),e.report=e.report||function(){console.warn("report needs to be defined")},this.inited=!1,this.checkParams(e),this.init(e)}return m(t,[{key:"checkParams",value:function(t){if(!t.feID)throw Error("feID必传");if(!t.report||"function"!=typeof t.report)throw Error("请填写自定义上报函数")}},{key:"init",value:function(t){if(!this.inited&&!$()){try{this.opts=t;var e=new Z(t.feID,t.maxLine);this.forms=e,this.panel=new D(this),this.panel.init(t),new H(e).probe(),new F(e).probe(t.logAjaxTrace,t.excludeAjaxKeywords),new U(e).probe(),this.inited=!0}catch(t){console.error(t)}if(t.containerFontSize){var n=document.createElement("style");n.innerText=".swal2-popup {font-size: ".concat(t.containerFontSize,"}"),document.head.appendChild(n)}}}},{key:"probe",value:function(){if(!$()){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forms.addLine({etype:"custom error",msg:e})}}},{key:"report",value:function(){if(!$()){var t=R();A(t)||this.opts.report(t)}}},{key:"showPanel",value:function(){this.panel.toggleShow()}}]),t}();export{tt as default};
