!function(t,e){t&&!t.getElementById("livereloadscript")&&((e=t.createElement("script")).async=1,e.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",e.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(e))}(self.document),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("md5"),require("nanoid"),require("file-saver"),require("sweetalert2"),require("axios"),require("ali-oss"),require("clipboard"),require("toastify-js")):"function"==typeof define&&define.amd?define(["md5","nanoid","file-saver","sweetalert2","axios","ali-oss","clipboard","toastify-js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).Mara=e(t.md5,t.nanoid,t.FileSaver,t.Swal,t.axios,t.OSS,t.Clipboard,t.Toastify)}(this,(function(t,e,n,o,r,i,a,s){"use strict";function c(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var u,f=c(t),p=c(n),l=c(o),d=c(r),h=c(i),m=c(a),y=c(s);function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function w(t,e,n,o,r,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(o,r)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function x(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),t}function S(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var q={qq:/\bm?qqbrowser\/([0-9.]+)/,360:function(t){return-1!==t.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/},aoyou:/\baoyou/,webview:/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/,firefox:/\bfirefox\/([0-9.ab]+)/,chrome:/ (?:chrome|crios|crmo)\/([0-9.]+)/,ie:/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,android:function(t){return-1===t.indexOf("android")?"":/\bversion\/([0-9.]+(?: beta)?)/},safari:/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//,opera:/\bopera/,unknow:"unknow"},j={windows:/\bwindows nt ([0-9.]+)/,macosx:/\bmac os x ([0-9._]+)/,linux:"linux",wphone:function(t){return-1!==t.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==t.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==t.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"},ios:function(t){return/\bcpu(?: iphone)? os /.test(t)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==t.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/},android:function(t){return t.indexOf("android")>=0?/\bandroid[ \/-]?([0-9.x]+)?/:t.indexOf("adr")>=0?t.indexOf("mqqbrowser")>=0?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"},unknow:"unknow"},k={weixin:/micromessenger/gi,qqvideo:/qqlivebrowser/gi,qqvideoipad:/qqlivehdbrowser/gi,shouqq:/qq\//gi,qqnews:/qqnews/gi,qzone:/qzone\//gi,unknow:"unknow"},A=function(t,e){return Object.prototype.toString.call(t)==="[object ".concat(e,"]")},T=function(t,e){var n=O[t.toLowerCase()];for(var o in e){var r=e[o],i=A(r,"Function")?r(I()):r;if(n.name=o,!0===i)break;if("[object String]"===toString(i)){if(-1!==I().indexOf(i))break}else if(A(i,"Object")){if(void 0!==i.version){n.version=i.version;break}}else if(i&&i.exec){var a=i.exec(I());if(a){a.length>=2&&a[1]?n.version=a[1].replace(/_/g,"."):n.version="0.0.0";break}}}return n},I=function(){if(!u){var t="__",e=navigator.userAgent||"",n=navigator.platform||"",o=navigator.appVersion||"",r=navigator.vendor||"";u=(u=e+t+n+t+o+t+r).toLowerCase()}return u},L=function(t){u||(T("os",j),T("platform",k),T("browser",q));return"all"===t||"full"===t?I():void 0!==t?O[t].name:"".concat(O.os.name).concat("  ","_").concat(O.os.version,"  ").concat(O.browser.name).concat("  ","_").concat(O.browser.version)},O={os:{name:"unknow",version:"0.0.0"},platform:{name:"unknow",version:"0.0.0"},browser:{name:"unknow",version:"0.0.0"}},C=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var o=e[0],r=Array.prototype.slice.call(e,1),i=0;i<r.length;i++){var a=r[i];for(var s in a)o[s]=a[s]}return o},B=function(t){if(!t)return!0;if(!t.length)return!0;for(var e=0,n=t.length-1;n>0;n--)t[n]||(e+=1);return e>t.length-1},E=function(t){var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";t=t||9;for(var n="",o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*e.length));return n},P=function(t){for(var e=function(t){return t>=65&&t<91||t>=97&&t<123},n=t.toString().split(""),o="",r=0;r<13;){var i=n[r],a="".concat(i).concat(n[r+1]),s="".concat(a).concat(n[r+2]);e(parseInt(a))?(o+=String.fromCharCode(a),r+=2):e(parseInt(s))?(o+=String.fromCharCode(s),r+=3):(o+=i,r++)}return o.split("").reverse().join("")},z=function(t,e){return f("".concat(t).concat(e))},R=function(){function t(){if(g(this,t),t.instance)return t.instance;this.__pool__={},t.instance=this}return x(t,[{key:"setItem",value:function(t,e){this.__pool__[t]=e}},{key:"getItem",value:function(t){return this.__pool__[t]}},{key:"remove",value:function(t){this.__pool__[t]=null}}]),t}();R.instance=null;var K=new R,M="csijs_",Q=function(t){return 0===t.indexOf(M)?t:M+t},N=function(t,e,n){"object"===v(e)&&(e=n?e:function(t){try{return JSON.stringify(t)}catch(e){return t}}(e)),function(t,e){try{K.setItem(t,e),localStorage.setItem(t,e)}catch(t){console.error(t)}}(Q(t),e)},D=function(t,e){var n=function(t){return K.getItem?K.getItem(t):null}(Q(t));return n?e?n:function(t){try{return JSON.parse(t)}catch(e){return t}}(n):null},J=function(t){!function(t){try{K&&K.removeItem(t)}catch(t){}}(Q(t))},H=function(){var t=D("info"),e=[],n=t?t.length:0;if(t&&n)for(var o=parseInt(t.max,10),r=parseInt(t.min,10);r<=o;r++){var i="".concat(t.type,"_").concat(r),a=D(i);e.push(a)}return e},F={download:"下载",copy:"复制",upload:"上传",report:"上报"},X=null;function G(t,e){this.csiReport=t,this.env=e.env||"prod",this.appid=e.appid,this.appname=e.feID,this.operation=e.operationMethod||"download",F[this.operation]&&("copy"===this.operation&&console.warn("%cmara warning: operationMethod===copy功能即将废弃，请尽快切换成'upload'或'download'模式","font-size: 20px;"),this.mainBtnText=F[this.operation])}var U=function(){var t,n=(t=regeneratorRuntime.mark((function t(n,o,r){var i,a,s,c,u,f,p,v,w,g,b,x,S,_;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=H().map((function(t){return"".concat(JSON.stringify(t,null,2),"\n")})),a=new Blob(i,{type:"text/plain;charset=utf-8"}),s="".concat(e.nanoid(),".dat"),c=(new Date).getTime(),u=P(c),f=z(o,c),"prod"===n?(p="https://m7-hlgw-c1-openapi.longfor.com/julianos-prod/",g="a2e33eb4-6516-43f9-bcc0-9c47b0f123b3"):(p="//api-uat.longfor.com/julianos-uat/",g="791f6690-0714-445f-9273-78a3199622d2"),b={"X-Gaia-Api-Key":g},o?(v="api/mara/alioss/sts",b["x-mara-signature"]=f,b["x-mara-slug"]=u,b["x-mara-app-name"]=r):v="api/admin/alioss/sts",w="".concat(p).concat(v),t.next=12,d({method:"get",url:w,withCredentials:!0,headers:b});case 12:return x=t.sent.data.Credentials,S=new h({region:"oss-cn-beijing",accessKeyId:x.AccessKeyId,accessKeySecret:x.AccessKeySecret,stsToken:x.SecurityToken,bucket:"prod-zws-wuguofeng"}),t.next=16,S.put("mara/".concat(s),a);case 16:return t.next=18,S.signatureUrl("mara/".concat(s));case 18:_=t.sent,l.fire({title:"上传完成",icon:"success",showConfirmButton:!0,confirmButtonText:"复制链接",showCancelButton:!0,cancelButtonText:"关闭",preConfirm:function(){document.querySelector(".swal2-confirm").setAttribute("data-clipboard-text",_),X&&X.destroy(),(X=new m(".swal2-confirm")).on("success",(function(t){console.log(t),y({text:"链接已复制",duration:1e3,gravity:"bottom",position:"center",style:{position:"fixed",margin:"0 auto",left:0,right:0,width:"80px",textAlign:"center",background:"black",zIndex:"999999",padding:"5px",opacity:.8,borderRadius:"5px",color:"white"}}).showToast(),t.clearSelection()}))}});case 20:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function a(t){w(i,o,r,a,s,"next",t)}function s(t){w(i,o,r,a,s,"throw",t)}a(void 0)}))});return function(t,e,o){return n.apply(this,arguments)}}();function V(t){this.csi=t,this.tapQueue=[]}G.prototype.createPage=function(){var t=this,n=H();B(n)?l.fire({title:"暂无异常",text:"稍后窗口会自动关闭",icon:"success",heightAuto:!1,timer:2e3}):l.fire({title:"收集完成",text:"收集到".concat(n.length,"条日志，点击下方按钮下载日志"),icon:"success",heightAuto:!1,showConfirmButton:!0,confirmButtonText:this.mainBtnText,showCancelButton:!0,cancelButtonText:"关闭",preConfirm:function(){return"upload"===t.operation?U(t.env,t.appid,t.appname):"copy"===t.operation?function(){var t=JSON.stringify(H(),null,2);document.querySelector(".swal2-confirm").setAttribute("data-clipboard-text",t),X&&X.destroy(),(X=new m(".swal2-confirm")).on("success",(function(t){y({text:"复制成功",duration:1e3,gravity:"bottom",position:"center",style:{position:"fixed",margin:"0 auto",left:0,right:0,width:"80px",textAlign:"center",background:"black",zIndex:"999999",padding:"5px",opacity:.8,borderRadius:"5px",color:"white"}}).showToast(),t.clearSelection()}))}():function(){var t=H().map((function(t){return"".concat(JSON.stringify(t,null,2),"\n")})),n=new Blob(t,{type:"text/plain;charset=utf-8"}),o="".concat(e.nanoid(),".dat");p.saveAs(n,o)}()}})},G.prototype.toggleShow=function(){l.isVisible()||this.createPage()},V.prototype={init:function(t){this.showPage=new G(this.csi.report.bind(this.csi),t),t.customPanelTrigger||this.bindDefaultTrigger()},onTapQueue:function(t,e){var n=this.tapQueue.length?this.tapQueue[this.tapQueue.length-1]:null;if(n&&t.timeStamp-n.timeStamp>300&&(this.tapQueue=[]),this.tapQueue.push(t),this.tapQueue.length===e)return this.tapQueue=[],!0}},V.prototype.bindDefaultTrigger=function(){var t=this;document.querySelector("html").addEventListener("touchend",(function(e){t.onTapQueue(e,4)&&setTimeout(t.toggleShow.bind(t),100)})),document.addEventListener("keydown",(function(e){(e=e||window.event).ctrlKey&&6===parseInt(e.key,10)&&t.showPage.toggleShow()}))},V.prototype.toggleShow=function(){this.showPage.toggleShow()};var W=function(t,e,n,o,r,i){return t.addLine({etype:"win error",msg:"".concat(e," \n ").concat(i&&i.stack),js:"".concat(n,":").concat(o,":").concat(r)}),!0},Y=function(t){this.forms=t};Y.prototype.probe=function(){var t=this,e=window.onerror;window.onerror=function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];"function"==typeof e&&e.apply(t,o),W(t.forms,o[0],o[1],o[2],o[3],o[4])}};var Z={},$=function(t){this.forms=t},tt=function(t,e,n){t.addLine({etype:"ajax error",msg:e,js:n.join(" :")})};$.prototype.probe=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0,r=this;this.logAjaxTrace=n,this.excludeKeywords=o||[];var i=XMLHttpRequest.prototype,a=i.open,s=i.send,c=i.setRequestHeader,u=function(e){for(var n=0;n<t.excludeKeywords.length;n++)if(-1!==e.indexOf(t.excludeKeywords[n]))return!0;return!1};XMLHttpRequest.prototype.open=function(){var t=Array.prototype.slice.call(arguments);if(t[1]&&u(t[1]))return a.apply(this,arguments);var n=e.nanoid();this.__xhrid=n,r.addListener(this,arguments),a.apply(this,arguments)},XMLHttpRequest.prototype.setRequestHeader=function(){if(!this.__xhrid)return c.apply(this,arguments);var t=Array.prototype.slice.call(arguments),e=t[0],n=t[1];"content-type"===e.toLowerCase()&&n.toLowerCase().includes("application/json")&&(Z[this.__xhrid].recordPayload=!0),c.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){if(!this.__xhrid)return s.apply(this,arguments);Z[this.__xhrid].recordPayload&&(Z[this.__xhrid].payload=Array.prototype.slice.call(arguments)),s.apply(this,arguments)}},$.prototype.addListener=function(t,e){var n=this;if(!Z[t.__xhrid]){Z[t.__xhrid]={xhr:t};var o=t.ontimeout;t.addEventListener("loadend",(function(){var o,r=t.status,i=Z[t.__xhrid].payload||{};try{i=JSON.parse(i)}catch(t){i=i}try{o=JSON.parse(t.response)}catch(e){o=t.response}var a={status:r,payload:i,response:o};0!==parseInt(r)&&(/^2[0-9]{1,3}/gi.test(r)?n.logAjaxTrace&&function(t,e,n){t.addLine({etype:"ajax trace",msg:e,js:n.join(":")})}(n.forms,a,S(e)):tt(n.forms,a,S(e)))})),t.addEventListener("error",(function(){tt(n.forms,t.status||"networkError",S(e))})),t.ontimeout=function(){n.forms.addLine({etype:"ajax error",msg:"timeout ".concat(t.status),js:e.join(" :")});for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];o&&o.apply(n,i)}}};var et=function(t){this.forms=t};et.prototype.probe=function(){var t=this;if(window.fetch){var e=window.fetch;window.fetch=function(n,o){var r="GET",i=n||"";return"string"==typeof n?r=o&&o.method?o.method:r:"[object Request]"===Object.prototype.toString.call(n)&&(r=n.method||r,i=n.url||""),e(n,o).then((function(e){var n="".concat(e.status);return/^2[0-9]{1,3}/gi.test(n)||0==+n||t.forms.addLine({etype:"fetch error",msg:"status:".concat(e.status),js:"".concat(r," :").concat(i)}),e})).catch((function(e){var n;try{n=e&&e.message?e.message:JSON.stringify(e)}catch(t){n=e&&e.message?e.message:e}throw t.forms.addLine({etype:"fetch error",msg:n,js:"".concat(r," :").concat(i)}),e}))}}};var nt=function(){this.fid="",this.uid="",this.min=0,this.max=0,this.type="",this.length=""},ot=function(){this.pid="",this.index="",this.time="",this.ua="",this.etype="",this.msg="",this.url="",this.other=""},rt=function(t,e,n){var o={feid:t,uid:E(),min:0,max:0,type:e,length:0};this.maxLine=n||20,this.info=C(new nt,o,D("info")),this.line=new ot};rt.prototype={addLine:function(t){var e={pid:E(6),index:parseInt(this.info.max,10)+1,time:Date.now(),ua:L()};!function(t){for(var e in t)t[e]="";t.url=location?location.href:""}(this.line),C(this.line,e,t);var n="".concat(this.info.type,"_").concat(this.line.index);N(n,this.line),this.updateInfo(this.line)},updateInfo:function(t){var e=parseInt(t.index,10),n=parseInt(this.info.min,10),o=e-(n=n||e)+1;if(o>this.maxLine){for(var r=o-this.maxLine,i=0;i<r;i++){var a="".concat(this.info.type,"_").concat(n+i);J(a)}o=this.maxLine}this.info.length=o,this.info.min=e-o+1,this.info.max=e,N("info",this.info)}};var it=function(t,e){this.errTable=new rt(t,"err",e)};it.prototype={addLine:function(t){var e=this.errTable;setTimeout((function(){e.addLine(t)}),0)}};var at=function(){L();var t=O.browser,e=t.name,n=parseFloat(t.version);return"ie"===e&&n<9},st=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g(this,t),e.report=e.report||function(){console.warn("report needs to be defined")},this.inited=!1,this.checkParams(e),this.init(e)}return x(t,[{key:"checkParams",value:function(t){if(!t.feID)throw Error("feID必传");if(!t.report||"function"!=typeof t.report)throw Error("请填写自定义上报函数")}},{key:"init",value:function(t){if(!this.inited&&!at()){try{this.opts=t;var e=new it(t.feID,t.maxLine);this.forms=e,this.panel=new V(this),this.panel.init(t),new Y(e).probe(),new $(e).probe(t.logAjaxTrace,t.excludeAjaxKeywords),new et(e).probe(),this.inited=!0}catch(t){console.error(t)}if(t.containerFontSize){var n=document.createElement("style");n.innerText=".swal2-popup {font-size: ".concat(t.containerFontSize,"}"),document.head.appendChild(n)}}}},{key:"probe",value:function(){if(!at()){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forms.addLine({etype:"custom error",msg:e})}}},{key:"report",value:function(){if(!at()){var t=H();B(t)||this.opts.report(t)}}},{key:"showPanel",value:function(){this.panel.toggleShow()}}]),t}();return st}));
